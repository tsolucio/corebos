/**
 * Copyright (C) 2010-2014 Graham Breach
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/**
 * TagCanvas 2.5
 * For more information, please contact <graham@goat1000.com>
 */
(function(){var J,H,I=Math.abs,ac=Math.sin,v=Math.cos,q=Math.max,aw=Math.min,aj=Math.ceil,C=Math.sqrt,al=Math.pow,f={},h={},k={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},w,b,N,ay,E,az,B=document,n,a={};for(J=0;J<256;++J){H=J.toString(16);if(J<16){H="0"+H}h[H]=h[H.toUpperCase()]=J.toString()+","}function ad(i){return typeof i!="undefined"}function F(i){return typeof i=="object"&&i!=null}function an(i,j,aA){return isNaN(i)?aA:aw(aA,q(j,i))}function at(){return false}function D(){return new Date().valueOf()}function z(aA,aD){var j=[],aB=aA.length,aC;for(aC=0;aC<aB;++aC){j.push(aA[aC])}j.sort(aD);return j}function ai(j){var aB=j.length-1,aA,aC;while(aB){aC=~~(Math.random()*aB);aA=j[aB];j[aB]=j[aC];j[aC]=aA;--aB}}function Z(i,aA,j){this.x=i;this.y=aA;this.z=j}E=Z.prototype;E.length=function(){return C(this.x*this.x+this.y*this.y+this.z*this.z)};E.dot=function(i){return this.x*i.x+this.y*i.y+this.z*i.z};E.cross=function(j){var i=this.y*j.z-this.z*j.y,aB=this.z*j.x-this.x*j.z,aA=this.x*j.y-this.y*j.x;return new Z(i,aB,aA)};E.angle=function(j){var i=this.dot(j),aA;if(i==0){return Math.PI/2}aA=i/(this.length()*j.length());if(aA>=1){return 0}if(aA<=-1){return Math.PI}return Math.acos(aA)};E.unit=function(){var i=this.length();return new Z(this.x/i,this.y/i,this.z/i)};function ae(aA,j){j=j*Math.PI/180;aA=aA*Math.PI/180;var i=ac(aA)*v(j),aC=-ac(j),aB=-v(aA)*v(j);return new Z(i,aC,aB)}function O(i){this[1]={1:i[0],2:i[1],3:i[2]};this[2]={1:i[3],2:i[4],3:i[5]};this[3]={1:i[6],2:i[7],3:i[8]}}ay=O.prototype;O.Identity=function(){return new O([1,0,0,0,1,0,0,0,1])};O.Rotation=function(aB,i){var j=ac(aB),aA=v(aB),aC=1-aA;return new O([aA+al(i.x,2)*aC,i.x*i.y*aC-i.z*j,i.x*i.z*aC+i.y*j,i.y*i.x*aC+i.z*j,aA+al(i.y,2)*aC,i.y*i.z*aC-i.x*j,i.z*i.x*aC-i.y*j,i.z*i.y*aC+i.x*j,aA+al(i.z,2)*aC])};ay.mul=function(aA){var aB=[],aE,aD,aC=(aA.xform?1:0);for(aE=1;aE<=3;++aE){for(aD=1;aD<=3;++aD){if(aC){aB.push(this[aE][1]*aA[1][aD]+this[aE][2]*aA[2][aD]+this[aE][3]*aA[3][aD])}else{aB.push(this[aE][aD]*aA)}}}return new O(aB)};ay.xform=function(aA){var j={},i=aA.x,aC=aA.y,aB=aA.z;j.x=i*this[1][1]+aC*this[2][1]+aB*this[3][1];j.y=i*this[1][2]+aC*this[2][2]+aB*this[3][2];j.z=i*this[1][3]+aC*this[2][3]+aB*this[3][3];return j};function o(aB,aD,aI,aF){var aE,aH,j,aG,aJ=[],aC=Math.PI*(3-C(5)),aA=2/aB;for(aE=0;aE<aB;++aE){aH=aE*aA-1+(aA/2);j=C(1-aH*aH);aG=aE*aC;aJ.push([v(aG)*j*aD,aH*aI,ac(aG)*j*aF])}return aJ}function S(aC,aA,aF,aL,aJ){var aK,aM=[],aD=Math.PI*(3-C(5)),aB=2/aC,aI,aH,aG,aE;for(aI=0;aI<aC;++aI){aH=aI*aB-1+(aB/2);aK=aI*aD;aG=v(aK);aE=ac(aK);aM.push(aA?[aH*aF,aG*aL,aE*aJ]:[aG*aF,aH*aL,aE*aJ])}return aM}function K(aA,aB,aE,aK,aI,aG){var aJ,aL=[],aC=Math.PI*2/aB,aH,aF,aD;for(aH=0;aH<aB;++aH){aJ=aH*aC;aF=v(aJ);aD=ac(aJ);aL.push(aA?[aG*aE,aF*aK,aD*aI]:[aF*aE,aG*aK,aD*aI])}return aL}function ah(aB,i,j,aA){return S(aB,0,i,j,aA)}function am(aB,i,j,aA){return S(aB,1,i,j,aA)}function c(aC,i,j,aA,aB){aB=isNaN(aB)?0:aB*1;return K(0,aC,i,j,aA,aB)}function l(aC,i,j,aA,aB){aB=isNaN(aB)?0:aB*1;return K(1,aC,i,j,aA,aB)}function R(aD,i){var aC=aD,aB,aA,j=(i*1).toPrecision(3)+")";if(aD[0]==="#"){if(!f[aD]){if(aD.length===4){f[aD]="rgba("+k[aD[1]]+k[aD[2]]+k[aD[3]]}else{f[aD]="rgba("+h[aD.substr(1,2)]+h[aD.substr(3,2)]+h[aD.substr(5,2)]}}aC=f[aD]+j}else{if(aD.substr(0,4)==="rgb("||aD.substr(0,4)==="hsl("){aC=(aD.replace("(","a(").replace(")",","+j))}else{if(aD.substr(0,5)==="rgba("||aD.substr(0,5)==="hsla("){aB=aD.lastIndexOf(",")+1,aA=aD.indexOf(")");i*=parseFloat(aD.substring(aB,aA));aC=aD.substr(0,aB)+i.toPrecision(3)+")"}}}return aC}function M(i,j){if(window.G_vmlCanvasManager){return null}var aA=B.createElement("canvas");aA.width=i;aA.height=j;return aA}function ag(){var j=M(3,3),aB,aA;if(!j){return false}aB=j.getContext("2d");aB.strokeStyle="#000";aB.shadowColor="#fff";aB.shadowBlur=3;aB.globalAlpha=0;aB.strokeRect(2,2,2,2);aB.globalAlpha=1;aA=aB.getImageData(2,2,1,1);j=null;return(aA.data[0]>0)}function af(aE,j,aD,aC){var aB=aE.createLinearGradient(0,0,j,0),aA;for(aA in aC){aB.addColorStop(1-aA,aC[aA])}aE.fillStyle=aB;aE.fillRect(0,aD,j,1)}function g(aC,aA,j){var aB=1024,aG=1,aF=aC.weightGradient,aE,aI,aD,aH;if(aC.gCanvas){aI=aC.gCanvas.getContext("2d");aG=aC.gCanvas.height}else{if(F(aF[0])){aG=aF.length}else{aF=[aF]}aC.gCanvas=aE=M(aB,aG);if(!aE){return null}aI=aE.getContext("2d");for(aD=0;aD<aG;++aD){af(aI,aB,aD,aF[aD])}}j=q(aw(j||0,aG-1),0);aH=aI.getImageData(~~((aB-1)*aA),j,1,1).data;return"rgba("+aH[0]+","+aH[1]+","+aH[2]+","+(aH[3]/255)+")"}function U(aJ,aC,j,aL,aD,aI,aE,aB,aH,aK){var aG=aD+(aE||0)+(aB&&aB[0]<0?I(aB[0]):0),aA=aD+(aE||0)+(aB&&aB[1]<0?I(aB[1]):0),aF,aM;aJ.font=aC;aJ.textBaseline="top";aJ.fillStyle=j;aI&&(aJ.shadowColor=aI);aE&&(aJ.shadowBlur=aE);aB&&(aJ.shadowOffsetX=aB[0],aJ.shadowOffsetY=aB[1]);for(aF=0;aF<aL.length;++aF){aM=aK?(aH-aK[aF])/2:0;aJ.fillText(aL[aF],aG+aM,aA);aA+=parseInt(aC)}}function ak(aE,i,aD,j,aB,aC,aA){if(aC){aE.beginPath();aE.moveTo(i,aD+aB-aC);aE.arcTo(i,aD,i+aC,aD,aC);aE.arcTo(i+j,aD,i+j,aD+aC,aC);aE.arcTo(i+j,aD+aB,i+j-aC,aD+aB,aC);aE.arcTo(i,aD+aB,i,aD+aB-aC,aC);aE.closePath();aE[aA?"stroke":"fill"]()}else{aE[aA?"strokeRect":"fillRect"](i,aD,j,aB)}}function t(aE,aM,aG,aR,aH,aO,aF,aP,aN,aL,i,aJ,aD,aK,aT){var aB=aG+I(i[0])+2*(aL+aJ)+aP,aI=aR+I(i[1])+2*(aL+aJ)+aP,aC,aU,aS,aQ,aA,j;aC=M(aB,aI);if(!aC){return null}aS=aA=aP/2;aQ=aB-aP;j=aI-aP;aJ+=aS;aU=aC.getContext("2d");if(aO){aU.fillStyle=aO;ak(aU,aS,aA,aQ,j,aD)}if(aP){aU.strokeStyle=aF;aU.lineWidth=aP;ak(aU,aS,aA,aQ,j,aD,true)}U(aU,aM,aH,aE,aJ,aN,aL,i,aK,aT);return aC}function u(aB,j,aC){var aA=M(j,aC),aD;if(!aA){return null}aD=aA.getContext("2d");aD.drawImage(aB,(j-aB.width)/2,(aC-aB.height)/2);return aA}function ap(aB,j,aC){var aA=M(j,aC),aD;if(!aA){return null}aD=aA.getContext("2d");aD.drawImage(aB,0,0,j,aC);return aA}function au(aM,aH,aN,aR,aI,aG,aF,aK,aD,aE){var aB=aH+((2*aK)+aG)*aR,aJ=aN+((2*aK)+aG)*aR,aC=M(aB,aJ),aQ,aP,aA,aO,j,aS,aL;if(!aC){return null}aG*=aR;aD*=aR;aP=aA=aG/2;aO=aB-aG;j=aJ-aG;aK=(aK*aR)+aP;aQ=aC.getContext("2d");if(aI){aQ.fillStyle=aI;ak(aQ,aP,aA,aO,j,aD)}if(aG){aQ.strokeStyle=aF;aQ.lineWidth=aG;ak(aQ,aP,aA,aO,j,aD,true)}if(aE){aS=M(aB,aJ);aL=aS.getContext("2d");aL.drawImage(aM,aK,aK,aH,aN);aL.globalCompositeOperation="source-in";aL.fillStyle=aF;aL.fillRect(0,0,aB,aJ);aL.globalCompositeOperation="destination-over";aL.drawImage(aC,0,0);aL.globalCompositeOperation="source-over";aQ.drawImage(aS,0,0)}else{aQ.drawImage(aM,aK,aK,aM.width,aM.height)}return{image:aC,width:aB/aR,height:aJ/aR}}function W(aG,aM,aI,aC,aK,aL,aB){var aN=I(aB[0]),aH=I(aB[1]),aD=aM+(aN>aL?aN+aL:aL*2)*aC,j=aI+(aH>aL?aH+aL:aL*2)*aC,aF=aC*((aL||0)+(aB[0]<0?aN:0)),aA=aC*((aL||0)+(aB[1]<0?aH:0)),aE,aJ;aE=M(aD,j);if(!aE){return null}aJ=aE.getContext("2d");aK&&(aJ.shadowColor=aK);aL&&(aJ.shadowBlur=aL*aC);aB&&(aJ.shadowOffsetX=aB[0]*aC,aJ.shadowOffsetY=aB[1]*aC);aJ.drawImage(aG,aF,aA,aM,aI);return{image:aE,width:aD/aC,height:j/aC}}function r(aM,aE,aK){var aL=parseInt(aM.toString().length*aK),aD=parseInt(aK*2*aM.length),aB=M(aL,aD),aH,j,aC,aG,aJ,aI,aA,aF;if(!aB){return null}aH=aB.getContext("2d");aH.fillStyle="#000";aH.fillRect(0,0,aL,aD);U(aH,aK+"px "+aE,"#fff",aM,0,0,0,[]);j=aH.getImageData(0,0,aL,aD);aC=j.width;aG=j.height;aF={min:{x:aC,y:aG},max:{x:-1,y:-1}};for(aI=0;aI<aG;++aI){for(aJ=0;aJ<aC;++aJ){aA=(aI*aC+aJ)*4;if(j.data[aA+1]>0){if(aJ<aF.min.x){aF.min.x=aJ}if(aJ>aF.max.x){aF.max.x=aJ}if(aI<aF.min.y){aF.min.y=aI}if(aI>aF.max.y){aF.max.y=aI}}}}if(aC!=aL){aF.min.x*=(aL/aC);aF.max.x*=(aL/aC)}if(aG!=aD){aF.min.y*=(aL/aG);aF.max.y*=(aL/aG)}aB=null;return aF}function m(i){return"'"+i.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function Y(i,j,aA){aA=aA||B;if(aA.addEventListener){aA.addEventListener(i,j,false)}else{aA.attachEvent("on"+i,j)}}function ao(aE,aA,aI,aD){var aJ=aD.imageScale,aG,aB,aF,j,aC,aH;if(!aA.complete){return Y("load",function(){ao(aE,aA,aI,aD)},aA)}if(!aE.complete){return Y("load",function(){ao(aE,aA,aI,aD)},aE)}aA.width=aA.width;aA.height=aA.height;if(aJ){aE.width=aA.width*aJ;aE.height=aA.height*aJ}aI.w=aE.width;aI.h=aE.height;if(aD.txtOpt){aB=aE;aG=aD.zoomMax*aD.txtScale;aC=aI.w*aG;aH=aI.h*aG;if(aC<aA.naturalWidth||aH<aA.naturalHeight){aB=ap(aE,aC,aH);if(aB){aI.image=aB}}else{aC=aI.w;aH=aI.h;aG=1}if(aD.shadow){aB=W(aI.image,aC,aH,aG,aD.shadow,aD.shadowBlur,aD.shadowOffset);if(aB){aI.image=aB.image;aI.w=aB.width;aI.h=aB.height}}if(aD.bgColour||aD.bgOutlineThickness){aF=aD.bgColour=="tag"?V(aI.a,"background-color"):aD.bgColour;j=aD.bgOutline=="tag"?V(aI.a,"color"):(aD.bgOutline||aD.textColour);aC=aI.image.width;aH=aI.image.height;if(aD.outlineMethod=="colour"){aB=au(aI.image,aC,aH,aG,aF,aD.bgOutlineThickness,aD.outlineColour,aD.padding,aD.bgRadius,1);if(aB){aI.oimage=aB.image}}aB=au(aI.image,aC,aH,aG,aF,aD.bgOutlineThickness,j,aD.padding,aD.bgRadius);if(aB){aI.image=aB.image;aI.w=aB.width;aI.h=aB.height}}if(aD.outlineMethod=="size"){if(aD.outlineIncrease>0){aI.w+=2*aD.outlineIncrease;aI.h+=2*aD.outlineIncrease;aC=aG*aI.w;aH=aG*aI.h;aB=ap(aI.image,aC,aH);aI.oimage=aB;aI.image=u(aI.image,aI.oimage.width,aI.oimage.height)}else{aC=aG*(aI.w+(2*aD.outlineIncrease));aH=aG*(aI.h+(2*aD.outlineIncrease));aB=ap(aI.image,aC,aH);aI.oimage=u(aB,aI.image.width,aI.image.height)}}}}function V(aB,aA){var j=B.defaultView,i=aA.replace(/\-([a-z])/g,function(aC){return aC.charAt(1).toUpperCase()});return(j&&j.getComputedStyle&&j.getComputedStyle(aB,null).getPropertyValue(aA))||(aB.currentStyle&&aB.currentStyle[i])}function s(j,aB,aA){var i=1,aC;if(aB){i=1*(j.getAttribute(aB)||aA)}else{if(aC=V(j,"font-size")){i=(aC.indexOf("px")>-1&&aC.replace("px","")*1)||(aC.indexOf("pt")>-1&&aC.replace("pt","")*1.25)||aC*3.3}}return i}function e(i){return i.target&&ad(i.target.id)?i.target.id:i.srcElement.parentNode.id}function P(aC,aD){var aB,aA,i=parseInt(V(aD,"width"))/aD.width,j=parseInt(V(aD,"height"))/aD.height;if(ad(aC.offsetX)){aB={x:aC.offsetX,y:aC.offsetY}}else{aA=X(aD.id);if(ad(aC.changedTouches)){aC=aC.changedTouches[0]}if(aC.pageX){aB={x:aC.pageX-aA.x,y:aC.pageY-aA.y}}}if(aB&&i&&j){aB.x/=i;aB.y/=j}return aB}function A(aA){var j=aA.target||aA.fromElement.parentNode,i=x.tc[j.id];if(i){i.mx=i.my=-1;i.UnFreeze();i.EndDrag()}}function aa(aE){var aB,aA=x,j,aD,aC=e(aE);for(aB in aA.tc){j=aA.tc[aB];if(j.tttimer){clearTimeout(j.tttimer);j.tttimer=null}}if(aC&&aA.tc[aC]){j=aA.tc[aC];if(aD=P(aE,j.canvas)){j.mx=aD.x;j.my=aD.y;j.Drag(aE,aD)}j.drawn=0}}function y(aB){var j=x,i=B.addEventListener?0:1,aA=e(aB);if(aA&&aB.button==i&&j.tc[aA]){j.tc[aA].BeginDrag(aB)}}function ax(aC){var aA=x,j=B.addEventListener?0:1,aB=e(aC),i;if(aB&&aC.button==j&&aA.tc[aB]){i=aA.tc[aB];aa(aC);if(!i.EndDrag()&&!i.touched){i.Clicked(aC)}}}function Q(aA){var i=x,j=e(aA);if(j&&aA.changedTouches&&i.tc[j]){i.tc[j].touched=1;i.tc[j].BeginDrag(aA)}}function p(aA){var i=x,j=e(aA);if(j&&aA.changedTouches&&i.tc[j]){ar(aA);if(!i.tc[j].EndDrag()){i.tc[j].Draw();i.tc[j].Clicked(aA)}}}function ar(aE){var aB,aA=x,j,aD,aC=e(aE);for(aB in aA.tc){j=aA.tc[aB];if(j.tttimer){clearTimeout(j.tttimer);j.tttimer=null}}if(aC&&aA.tc[aC]&&aE.changedTouches){j=aA.tc[aC];if(aD=P(aE,j.canvas)){j.mx=aD.x;j.my=aD.y;j.Drag(aE,aD)}j.drawn=0}}function ab(aA){var i=x,j=e(aA);if(j&&i.tc[j]){aA.cancelBubble=true;aA.returnValue=false;aA.preventDefault&&aA.preventDefault();i.tc[j].Wheel((aA.wheelDelta||aA.detail)>0)}}function L(aC){var j=x.tc,aB,aA;aC=aC||D();for(aB in j){aA=j[aB].interval;j[aB].Draw(aC)}x.NextFrame(aA)}function X(aA){var aD=B.getElementById(aA),i=aD.getBoundingClientRect(),aG=B.documentElement,aE=B.body,aF=window,aB=aF.pageXOffset||aG.scrollLeft,aH=aF.pageYOffset||aG.scrollTop,aC=aG.clientLeft||aE.clientLeft,j=aG.clientTop||aE.clientTop;return{x:i.left+aB-aC,y:i.top+aH-j}}function T(j,aB,aC,aA){var i=j.radius*j.z1/(j.z1+j.z2+aB.z);return{x:aB.x*i*aC,y:aB.y*i*aA,z:aB.z,w:(j.z1-aB.z)/j.z2}}function av(i){this.e=i;this.br=0;this.line=[];this.text=[];this.original=i.innerText||i.textContent}az=av.prototype;az.Lines=function(aC){var aB=aC?1:0,aD,j,aA;aC=aC||this.e;aD=aC.childNodes;j=aD.length;for(aA=0;aA<j;++aA){if(aD[aA].nodeName=="BR"){this.text.push(this.line.join(" "));this.br=1}else{if(aD[aA].nodeType==3){if(this.br){this.line=[aD[aA].nodeValue];this.br=0}else{this.line.push(aD[aA].nodeValue)}}else{this.Lines(aD[aA])}}}aB||this.br||this.text.push(this.line.join(" "));return this.text};az.SplitWidth=function(aA,aH,aE,aD){var aC,aB,aG,aF=[];aH.font=aD+"px "+aE;for(aC=0;aC<this.text.length;++aC){aG=this.text[aC].split(/\s+/);this.line=[aG[0]];for(aB=1;aB<aG.length;++aB){if(aH.measureText(this.line.join(" ")+" "+aG[aB]).width>aA){aF.push(this.line.join(" "));this.line=[aG[aB]]}else{this.line.push(aG[aB])}}aF.push(this.line.join(" "))}return this.text=aF};function G(i,j){this.ts=D();this.tc=i;this.tag=j;this.x=this.y=this.w=this.h=this.sc=1;this.z=0;this.Draw=i.pulsateTo<1&&i.outlineMethod!="colour"?this.DrawPulsate:this.DrawSimple;this.radius=i.outlineRadius|0;this.SetMethod(i.outlineMethod)}w=G.prototype;w.SetMethod=function(aA){var j={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],size:["PreDraw","DrawColour"],none:["LastDraw"]},i=j[aA]||j.outline;if(aA=="none"){this.Draw=function(){return 1}}else{this.drawFunc=this[i[1]]}this[i[0]]=this.Draw};w.Update=function(aG,aF,aH,aC,aD,aE,aB,i){var j=this.tc.outlineOffset,aA=2*j;this.x=aD*aG+aB-j;this.y=aD*aF+i-j;this.w=aD*aH+aA;this.h=aD*aC+aA;this.sc=aD;this.z=aE};w.DrawOutline=function(aD,i,aC,j,aA,aB){aD.strokeStyle=aB;ak(aD,i,aC,j,aA,this.radius,true)};w.DrawColour=function(aB,aE,aC,aF,aA,i,aG,j,aD){if(aG.oimage){aG.alpha=1;aG.Draw(aB,j,aD,aG.oimage);return 1}return this[aG.image?"DrawColourImage":"DrawColourText"](aB,aE,aC,aF,aA,i,aG,j,aD)};w.DrawColourText=function(aC,aF,aD,aG,aA,i,aH,j,aE){var aB=aH.colour;aH.colour=i;aH.alpha=1;aH.Draw(aC,j,aE);aH.colour=aB;return 1};w.DrawColourImage=function(aF,aI,aG,aJ,aE,i,aM,j,aH){var aK=aF.canvas,aC=~~q(aI,0),aB=~~q(aG,0),aD=aw(aK.width-aC,aJ)+0.5|0,aL=aw(aK.height-aB,aE)+0.5|0,aA;if(n){n.width=aD,n.height=aL}else{n=M(aD,aL)}if(!n){return this.SetMethod("outline")}aA=n.getContext("2d");aA.drawImage(aK,aC,aB,aD,aL,0,0,aD,aL);aF.clearRect(aC,aB,aD,aL);aM.alpha=1;aM.Draw(aF,j,aH);aF.setTransform(1,0,0,1,0,0);aF.save();aF.beginPath();aF.rect(aC,aB,aD,aL);aF.clip();aF.globalCompositeOperation="source-in";aF.fillStyle=i;aF.fillRect(aC,aB,aD,aL);aF.restore();aF.globalCompositeOperation="destination-over";aF.drawImage(n,0,0,aD,aL,aC,aB,aD,aL);aF.globalCompositeOperation="source-over";return 1};w.DrawBlock=function(aD,i,aC,j,aA,aB){aD.fillStyle=aB;ak(aD,i,aC,j,aA,this.radius)};w.DrawSimple=function(aC,i,j,aB){var aA=this.tc;aC.setTransform(1,0,0,1,0,0);aC.strokeStyle=aA.outlineColour;aC.lineWidth=aA.outlineThickness;aC.shadowBlur=aC.shadowOffsetX=aC.shadowOffsetY=0;aC.globalAlpha=1;return this.drawFunc(aC,this.x,this.y,this.w,this.h,aA.outlineColour,i,j,aB)};w.DrawPulsate=function(aD,i,j,aB){var aC=D()-this.ts,aA=this.tc;aD.setTransform(1,0,0,1,0,0);aD.strokeStyle=aA.outlineColour;aD.lineWidth=aA.outlineThickness;aD.shadowBlur=aD.shadowOffsetX=aD.shadowOffsetY=0;aD.globalAlpha=aA.pulsateTo+((1-aA.pulsateTo)*(0.5+(v(2*Math.PI*aC/(1000*aA.pulsateTime))/2)));return this.drawFunc(aD,this.x,this.y,this.w,this.h,aA.outlineColour,i,j,aB)};w.Active=function(aA,i,j){return(i>=this.x&&j>=this.y&&i<=this.x+this.w&&j<=this.y+this.h)};w.PreDraw=w.PostDraw=w.LastDraw=at;function d(aB,aM,aI,aL,aJ,aC,aA,aE,aK,aD,aH,j,aG,i){var aF=aB.ctxt;this.tc=aB;this.image=aM.src?aM:null;this.text=aM.src?[]:aM;this.text_original=i;this.line_widths=[];this.title=aI.title||null;this.a=aI;this.position=new Z(aL[0],aL[1],aL[2]);this.x=this.y=this.z=0;this.w=aJ;this.h=aC;this.colour=aA||aB.textColour;this.bgColour=aE||aB.bgColour;this.bgRadius=aK|0;this.bgOutline=aD||this.colour;this.bgOutlineThickness=aH|0;this.textFont=j||aB.textFont;this.padding=aG|0;this.sc=this.alpha=1;this.weighted=!aB.weight;this.outline=new G(aB,this);if(!this.image){this.textHeight=aB.textHeight;this.Measure(aF,aB)}this.SetShadowColour=aB.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed;this.SetDraw(aB)}b=d.prototype;b.EqualTo=function(aA){var j=aA.getElementsByTagName("img");if(this.a.href!=aA.href){return 0}if(j.length){return this.image.src==j[0].src}return(aA.innerText||aA.textContent)==this.text_original};b.SetDraw=function(i){this.Draw=this.image?(i.ie>7?this.DrawImageIE:this.DrawImage):this.DrawText;i.noSelect&&(this.CheckActive=at)};b.MeasureText=function(aD){var aB,aA=this.text.length,j=0,aC;for(aB=0;aB<aA;++aB){this.line_widths[aB]=aC=aD.measureText(this.text[aB]).width;j=q(j,aC)}return j};b.Measure=function(aF,j){var aD=r(this.text,this.textFont,this.textHeight),aB,aC,aE,aA,i;this.h=aD?aD.max.y+aD.min.y:this.textHeight;aF.font=this.font=this.textHeight+"px "+this.textFont;this.w=this.MeasureText(aF);if(j.txtOpt){aB=j.txtScale;aC=aB*this.textHeight;aE=aC+"px "+this.textFont;aA=[aB*j.shadowOffset[0],aB*j.shadowOffset[1]];aF.font=aE;i=this.MeasureText(aF);this.image=t(this.text,aE,i+aB,(aB*this.h)+aB,this.colour,this.bgColour,this.bgOutline,aB*this.bgOutlineThickness,j.shadow,aB*j.shadowBlur,aA,aB*this.padding,aB*this.bgRadius,i,this.line_widths);if(j.outlineMethod=="colour"){this.oimage=t(this.text,aE,i+aB,(aB*this.h)+aB,j.outlineColour,this.bgColour,j.outlineColour,aB*this.bgOutlineThickness,j.shadow,aB*j.shadowBlur,aA,aB*this.padding,aB*this.bgRadius,i,this.line_widths)}else{if(j.outlineMethod=="size"){aD=r(this.text,this.textFont,this.textHeight+j.outlineIncrease);aC=aD.max.y+aD.min.y;aE=(aB*(this.textHeight+j.outlineIncrease))+"px "+this.textFont;aF.font=aE;i=this.MeasureText(aF);this.oimage=t(this.text,aE,i+aB,(aB*aC)+aB,this.colour,this.bgColour,this.bgOutline,aB*this.bgOutlineThickness,j.shadow,aB*j.shadowBlur,aA,aB*this.padding,aB*this.bgRadius,i,this.line_widths);if(j.outlineIncrease>0){this.image=u(this.image,this.oimage.width,this.oimage.height)}else{this.oimage=u(this.oimage,this.image.width,this.image.height)}}}if(this.image){this.w=this.image.width/aB;this.h=this.image.height/aB}this.SetDraw(j);j.txtOpt=!!this.image}};b.SetFont=function(i,j){this.textFont=i;this.colour=j;this.Measure(this.tc.ctxt,this.tc)};b.SetWeight=function(aA){var j=this.tc,aC=j.weightMode.split(/[, ]/),i,aB,aD=aA.length;if(!this.text.length){return}this.weighted=true;for(aB=0;aB<aD;++aB){i=aC[aB]||"size";if("both"==i){this.Weight(aA[aB],j.ctxt,j,"size",j.min_weight[aB],j.max_weight[aB],aB);this.Weight(aA[aB],j.ctxt,j,"colour",j.min_weight[aB],j.max_weight[aB],aB)}else{this.Weight(aA[aB],j.ctxt,j,i,j.min_weight[aB],j.max_weight[aB],aB)}}this.Measure(j.ctxt,j)};b.Weight=function(aA,aF,aB,j,aE,aC,aD){var i=(aA-aE)/(aC-aE);if("colour"==j){this.colour=g(aB,i,aD)}else{if("bgcolour"==j){this.bgColour=g(aB,i,aD)}else{if("bgoutline"==j){this.bgOutline=g(aB,i,aD)}else{if("size"==j){if(aB.weightSizeMin>0&&aB.weightSizeMax>aB.weightSizeMin){this.textHeight=aB.weightSize*(aB.weightSizeMin+(aB.weightSizeMax-aB.weightSizeMin)*i)}else{this.textHeight=aA*aB.weightSize}}}}}};b.SetShadowColourFixed=function(aA,j,i){aA.shadowColor=j};b.SetShadowColourAlpha=function(aA,j,i){aA.shadowColor=R(j,i)};b.DrawText=function(aC,aF,aB){var aG=this.tc,aE=this.x,aD=this.y,aH=this.sc,j,aA;aC.globalAlpha=this.alpha;aC.fillStyle=this.colour;aG.shadow&&this.SetShadowColour(aC,aG.shadow,this.alpha);aC.font=this.font;aE+=aF/aH;aD+=(aB/aH)-(this.h/2);for(j=0;j<this.text.length;++j){aA=aE-(this.line_widths[j]/2);aC.setTransform(aH,0,0,aH,aH*aA,aH*aD);aC.fillText(this.text[j],0,0);aD+=this.textHeight}};b.DrawImage=function(aC,aJ,aB,aE){var aG=this.x,aD=this.y,aK=this.sc,j=aE||this.image,aH=this.w,aA=this.h,aF=this.alpha,aI=this.shadow;aC.globalAlpha=aF;aI&&this.SetShadowColour(aC,aI,aF);aG+=(aJ/aK)-(aH/2);aD+=(aB/aK)-(aA/2);aC.setTransform(aK,0,0,aK,aK*aG,aK*aD);aC.drawImage(j,0,0,aH,aA)};b.DrawImageIE=function(aC,aG,aB){var j=this.image,aH=this.sc,aF=j.width=this.w*aH,aA=j.height=this.h*aH,aE=(this.x*aH)+aG-(aF/2),aD=(this.y*aH)+aB-(aA/2);aC.setTransform(1,0,0,1,0,0);aC.globalAlpha=this.alpha;aC.drawImage(j,aE,aD)};b.Calc=function(i,aA){var j,aD=this.tc,aC=aD.minBrightness,aB=aD.maxBrightness,aE=aD.max_radius;j=i.xform(this.position);this.xformed=j;j=T(aD,j,aD.stretchX,aD.stretchY);this.x=j.x;this.y=j.y;this.z=j.z;this.sc=j.w;this.alpha=aA*an(aC+(aB-aC)*(aE-this.z)/(2*aE),0,1)};b.UpdateActive=function(aF,aA,aD){var aC=this.outline,j=this.w,aB=this.h,i=this.x-j/2,aE=this.y-aB/2;aC.Update(i,aE,j,aB,this.sc,this.z,aA,aD);return aC};b.CheckActive=function(aC,i,aB){var j=this.tc,aA=this.UpdateActive(aC,i,aB);return aA.Active(aC,j.mx,j.my)?aA:null};b.Clicked=function(aD){var j=this.a,aA=j.target,aB=j.href,i;if(aA!=""&&aA!="_self"){if(self.frames[aA]){self.frames[aA].document.location=aB}else{try{if(top.frames[aA]){top.frames[aA].document.location=aB;return}}catch(aC){}window.open(aB,aA)}return}if(B.createEvent){i=B.createEvent("MouseEvents");i.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null);if(!j.dispatchEvent(i)){return}}else{if(j.fireEvent){if(!j.fireEvent("onclick")){return}}}B.location=aB};function x(aF,j,aB){var aA,aD,aE=B.getElementById(aF),aC=["id","class","innerHTML"];if(!aE){throw 0}if(ad(window.G_vmlCanvasManager)){aE=window.G_vmlCanvasManager.initElement(aE);this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])}if(aE&&(!aE.getContext||!aE.getContext("2d").fillText)){aD=B.createElement("DIV");for(aA=0;aA<aC.length;++aA){aD[aC[aA]]=aE[aC[aA]]}aE.parentNode.insertBefore(aD,aE);aE.parentNode.removeChild(aE);throw 0}for(aA in x.options){this[aA]=aB&&ad(aB[aA])?aB[aA]:(ad(x[aA])?x[aA]:x.options[aA])}this.canvas=aE;this.ctxt=aE.getContext("2d");this.z1=250/this.depth;this.z2=this.z1/this.zoom;this.radius=aw(aE.height,aE.width)*0.0075;this.max_weight=[];this.min_weight=[];this.textFont=this.textFont&&m(this.textFont);this.textHeight*=1;this.pulsateTo=an(this.pulsateTo,0,1);this.minBrightness=an(this.minBrightness,0,1);this.maxBrightness=an(this.maxBrightness,this.minBrightness,1);this.ctxt.textBaseline="top";this.lx=(this.lock+"").indexOf("x")+1;this.ly=(this.lock+"").indexOf("y")+1;this.frozen=this.dx=this.dy=this.fixedAnim=this.touched=0;this.fixedAlpha=1;this.source=j||aF;this.transform=O.Identity();this.startTime=this.time=D();this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition;this.animTiming=(typeof x[this.animTiming]=="function"?x[this.animTiming]:x.Smooth);if(this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]){this.ctxt.shadowColor=this.shadow;this.shadow=this.ctxt.shadowColor;this.shadowAlpha=ag()}else{delete this.shadow}this.Load();if(j&&this.hideTags){(function(i){if(x.loaded){i.HideTags()}else{Y("load",function(){i.HideTags()},window)}})(this)}this.yaw=this.initial?this.initial[0]*this.maxSpeed:0;this.pitch=this.initial?this.initial[1]*this.maxSpeed:0;if(this.tooltip){if(this.tooltip=="native"){this.Tooltip=this.TooltipNative}else{this.Tooltip=this.TooltipDiv;if(!this.ttdiv){this.ttdiv=B.createElement("div");this.ttdiv.className=this.tooltipClass;this.ttdiv.style.position="absolute";this.ttdiv.style.zIndex=aE.style.zIndex+1;Y("mouseover",function(i){i.target.style.display="none"},this.ttdiv);B.body.appendChild(this.ttdiv)}}}else{this.Tooltip=this.TooltipNone}if(!this.noMouse&&!a[aF]){Y("mousemove",aa,aE);Y("mouseout",A,aE);Y("mouseup",ax,aE);Y("touchstart",Q,aE);Y("touchend",p,aE);Y("touchcancel",p,aE);Y("touchmove",ar,aE);if(this.dragControl){Y("mousedown",y,aE);Y("selectstart",at,aE)}if(this.wheelZoom){Y("mousewheel",ab,aE);Y("DOMMouseScroll",ab,aE)}a[aF]=1}x.started||(x.started=setTimeout(L,this.interval))}N=x.prototype;N.SourceElements=function(){if(B.querySelectorAll){return B.querySelectorAll("#"+this.source)}return[B.getElementById(this.source)]};N.HideTags=function(){var aA=this.SourceElements(),j;for(j=0;j<aA.length;++j){aA[j].style.display="none"}};N.GetTags=function(){var aE=this.SourceElements(),aD,aA=[],aC,aB;for(aC=0;aC<aE.length;++aC){aD=aE[aC].getElementsByTagName("a");for(aB=0;aB<aD.length;++aB){aA.push(aD[aB])}}return aA};N.CreateTag=function(aD,j){var aG=aD.getElementsByTagName("img"),aC,aH,aF,aA,aE,aB;j=j||[0,0,0];if(aG.length){aC=new Image;aC.src=aG[0].src;aH=new d(this,aC,aD,j,0,0);ao(aC,aG[0],aH,this);return aH}aF=new av(aD);aH=aF.Lines();aA=this.textFont||m(V(aD,"font-family"));if(this.splitWidth){aH=aF.SplitWidth(this.splitWidth,this.ctxt,aA,this.textHeight)}aE=this.bgColour=="tag"?V(aD,"background-color"):this.bgColour;aB=this.bgOutline=="tag"?V(aD,"color"):this.bgOutline;return new d(this,aH,aD,j,2,this.textHeight+2,this.textColour||V(aD,"color"),aE,this.bgRadius,aB,this.bgOutlineThickness,aA,this.padding,aF.original)};N.UpdateTag=function(aA,i){var aB=this.textColour||V(i,"color"),j=this.textFont||m(V(i,"font-family"));aA.a=i;aA.title=i.title;if(aA.colour!=aB||aA.textFont!=j){aA.SetFont(j,aB)}};N.Weight=function(aG){var aC=aG.length,aE,aA,aH,aD=[],j,aB=this.weightFrom?this.weightFrom.split(/[, ]/):[null],aF=aB.length;for(aA=0;aA<aC;++aA){aD[aA]=[];for(aH=0;aH<aF;++aH){aE=s(aG[aA].a,aB[aH],this.textHeight);if(!this.max_weight[aH]||aE>this.max_weight[aH]){this.max_weight[aH]=aE}if(!this.min_weight[aH]||aE<this.min_weight[aH]){this.min_weight[aH]=aE}aD[aA][aH]=aE}}for(aH=0;aH<aF;++aH){if(this.max_weight[aH]>this.min_weight[aH]){j=1}}if(j){for(aA=0;aA<aC;++aA){aG[aA].SetWeight(aD[aA])}}};N.Load=function(){var aJ=this.GetTags(),aF=[],aI,aE,aB,aA,j,aC,aH,aD=[],aG={sphere:o,vcylinder:ah,hcylinder:am,vring:c,hring:l};if(aJ.length){aD.length=aJ.length;for(aH=0;aH<aJ.length;++aH){aD[aH]=aH}this.shuffleTags&&ai(aD);aB=100*this.radiusX;aA=100*this.radiusY;j=100*this.radiusZ;this.max_radius=q(aB,q(aA,j));if(this.shapeArgs){this.shapeArgs[0]=aJ.length}else{aE=this.shape.toString().split(/[(),]/);aI=aE.shift();this.shape=aG[aI]||aG.sphere;this.shapeArgs=[aJ.length,aB,aA,j].concat(aE)}aC=this.shape.apply(this,this.shapeArgs);this.listLength=aJ.length;for(aH=0;aH<aJ.length;++aH){aF.push(this.CreateTag(aJ[aD[aH]],aC[aH]))}this.weight&&this.Weight(aF,true)}this.taglist=aF};N.Update=function(){var aJ=this.GetTags(),aI=[],aD=this.taglist,aK,aH=[],aF=[],aB,aG,aA,aE,aC;if(!this.shapeArgs){return this.Load()}if(aJ.length){aA=this.listLength=aJ.length;aG=aD.length;for(aE=0;aE<aG;++aE){aI.push(aD[aE]);aF.push(aE)}for(aE=0;aE<aA;++aE){for(aC=0,aK=0;aC<aG;++aC){if(aD[aC].EqualTo(aJ[aE])){this.UpdateTag(aI[aC],aJ[aE]);aK=aF[aC]=-1}}if(!aK){aH.push(aE)}}for(aE=0,aC=0;aE<aG;++aE){if(aF[aC]==-1){aF.splice(aC,1)}else{++aC}}if(aF.length){ai(aF);while(aF.length&&aH.length){aE=aF.shift();aC=aH.shift();aI[aE]=this.CreateTag(aJ[aC])}aF.sort(function(j,i){return j-i});while(aF.length){aI.splice(aF.pop(),1)}}aC=aI.length/(aH.length+1);aE=0;while(aH.length){aI.splice(aj(++aE*aC),0,this.CreateTag(aJ[aH.shift()]))}this.shapeArgs[0]=aA=aI.length;aB=this.shape.apply(this,this.shapeArgs);for(aE=0;aE<aA;++aE){aI[aE].position=new Z(aB[aE][0],aB[aE][1],aB[aE][2])}this.weight&&this.Weight(aI)}this.taglist=aI};N.SetShadow=function(i){i.shadowBlur=this.shadowBlur;i.shadowOffsetX=this.shadowOffset[0];i.shadowOffsetY=this.shadowOffset[1]};N.Draw=function(aK){if(this.paused){return}var aE=this.canvas,aC=aE.width,aJ=aE.height,aM=0,aB=(aK-this.time)*this.interval/1000,aI=aC/2+this.offsetX,aH=aJ/2+this.offsetY,aQ=this.ctxt,aG,aR,aO,aA=-1,aD=this.taglist,aN=aD.length,j=this.frontSelect,aL=(this.centreFunc==at),aF;this.time=aK;if(this.frozen&&this.drawn){return this.Animate(aC,aJ,aB)}aF=this.AnimateFixed();aQ.setTransform(1,0,0,1,0,0);for(aO=0;aO<aN;++aO){aD[aO].Calc(this.transform,this.fixedAlpha)}aD=z(aD,function(aS,i){return i.z-aS.z});if(aF&&this.fixedAnim.active){aG=this.fixedAnim.tag.UpdateActive(aQ,aI,aH)}else{this.active=null;for(aO=0;aO<aN;++aO){aR=this.mx>=0&&this.my>=0&&this.taglist[aO].CheckActive(aQ,aI,aH);if(aR&&aR.sc>aM&&(!j||aR.z<=0)){aG=aR;aA=aO;aG.tag=this.taglist[aO];aM=aR.sc}}this.active=aG}this.txtOpt||(this.shadow&&this.SetShadow(aQ));aQ.clearRect(0,0,aC,aJ);for(aO=0;aO<aN;++aO){if(!aL&&aD[aO].z<=0){try{this.centreFunc(aQ,aC,aJ,aI,aH)}catch(aP){alert(aP);this.centreFunc=at}aL=true}if(!(aG&&aG.tag==aD[aO]&&aG.PreDraw(aQ,aD[aO],aI,aH))){aD[aO].Draw(aQ,aI,aH)}aG&&aG.tag==aD[aO]&&aG.PostDraw(aQ)}if(this.freezeActive&&aG){this.Freeze()}else{this.UnFreeze();this.drawn=(aN==this.listLength)}if(this.fixedCallback){this.fixedCallback(this,this.fixedCallbackTag);this.fixedCallback=null}aF||this.Animate(aC,aJ,aB);aG&&aG.LastDraw(aQ);aE.style.cursor=aG?this.activeCursor:"";this.Tooltip(aG,this.taglist[aA])};N.TooltipNone=function(){};N.TooltipNative=function(j,i){this.canvas.title=j&&i.title?i.title:""};N.TooltipDiv=function(aC,j){var i=this,aB=i.ttdiv.style,aD=i.canvas.id,aA="none";if(aC&&j.title){if(j.title!=i.ttdiv.innerHTML){aB.display=aA}i.ttdiv.innerHTML=j.title;j.title=i.ttdiv.innerHTML;if(aB.display==aA&&!i.tttimer){i.tttimer=setTimeout(function(){var aE=X(aD);aB.display="block";aB.left=aE.x+i.mx+"px";aB.top=aE.y+i.my+24+"px";i.tttimer=null},i.tooltipDelay)}}else{aB.display=aA}};N.Transform=function(aD,i,aF){if(i||aF){var j=ac(i),aE=v(i),aG=ac(aF),aC=v(aF),aA=new O([aC,0,aG,0,1,0,-aG,0,aC]),aB=new O([1,0,0,0,aE,-j,0,j,aE]);aD.transform=aD.transform.mul(aA.mul(aB))}};N.AnimateFixed=function(){var aA,j,aC,i,aB;if(this.fadeIn){j=D()-this.startTime;if(j>=this.fadeIn){this.fadeIn=0;this.fixedAlpha=1}else{this.fixedAlpha=j/this.fadeIn}}if(this.fixedAnim){if(!this.fixedAnim.transform){this.fixedAnim.transform=this.transform}aA=this.fixedAnim,j=D()-aA.t0,aC=aA.angle,i,aB=this.animTiming(aA.t,j);this.transform=aA.transform;if(j>=aA.t){this.fixedCallbackTag=aA.tag;this.fixedCallback=aA.cb;this.fixedAnim=this.yaw=this.pitch=0}else{aC*=aB}i=O.Rotation(aC,aA.axis);this.transform=this.transform.mul(i);return(this.fixedAnim!=0)}return false};N.AnimatePosition=function(aA,aD,aB){var j=this,i=j.mx,aF=j.my,aC,aE;if(!j.frozen&&i>=0&&aF>=0&&i<aA&&aF<aD){aC=j.maxSpeed,aE=j.reverse?-1:1;j.lx||(j.yaw=aE*aB*((aC*2*i/aA)-aC));j.ly||(j.pitch=aE*aB*-((aC*2*aF/aD)-aC));j.initial=null}else{if(!j.initial){if(j.frozen&&!j.freezeDecel){j.yaw=j.pitch=0}else{j.Decel(j)}}}this.Transform(j,j.pitch,j.yaw)};N.AnimateDrag=function(j,aC,aB){var i=this,aA=100*aB*i.maxSpeed/i.max_radius/i.zoom;if(i.dx||i.dy){i.lx||(i.yaw=i.dx*aA/i.stretchX);i.ly||(i.pitch=i.dy*-aA/i.stretchY);i.dx=i.dy=0;i.initial=null}else{if(!i.initial){i.Decel(i)}}this.Transform(i,i.pitch,i.yaw)};N.Freeze=function(){if(!this.frozen){this.preFreeze=[this.yaw,this.pitch];this.frozen=1;this.drawn=0}};N.UnFreeze=function(){if(this.frozen){this.yaw=this.preFreeze[0];this.pitch=this.preFreeze[1];this.frozen=0}};N.Decel=function(i){var aA=i.minSpeed,aB=I(i.yaw),j=I(i.pitch);if(!i.lx&&aB>aA){i.yaw=aB>i.z0?i.yaw*i.decel:0}if(!i.ly&&j>aA){i.pitch=j>i.z0?i.pitch*i.decel:0}};N.Zoom=function(i){this.z2=this.z1*(1/i);this.drawn=0};N.Clicked=function(aA){var i=this.active;try{if(i&&i.tag){if(this.clickToFront===false||this.clickToFront===null){i.tag.Clicked(aA)}else{this.TagToFront(i.tag,this.clickToFront,function(){i.tag.Clicked(aA)},true)}}}catch(j){}};N.Wheel=function(j){var aA=this.zoom+this.zoomStep*(j?1:-1);this.zoom=aw(this.zoomMax,q(this.zoomMin,aA));this.Zoom(this.zoom)};N.BeginDrag=function(i){this.down=P(i,this.canvas);i.cancelBubble=true;i.returnValue=false;i.preventDefault&&i.preventDefault()};N.Drag=function(aC,aB){if(this.dragControl&&this.down){var aA=this.dragThreshold*this.dragThreshold,j=aB.x-this.down.x,i=aB.y-this.down.y;if(this.dragging||j*j+i*i>aA){this.dx=j;this.dy=i;this.dragging=1;this.down=aB}}};N.EndDrag=function(){var i=this.dragging;this.dragging=this.down=null;return i};N.Pause=function(){this.paused=true};N.Resume=function(){this.paused=false};N.SetSpeed=function(j){this.initial=j;this.yaw=j[0]*this.maxSpeed;this.pitch=j[1]*this.maxSpeed};N.FindTag=function(aA){if(!ad(aA)){return null}ad(aA.index)&&(aA=aA.index);if(!F(aA)){return this.taglist[aA]}var aB,aC,j;if(ad(aA.id)){aB="id",aC=aA.id}else{if(ad(aA.text)){aB="innerText",aC=aA.text}}for(j=0;j<this.taglist.length;++j){if(this.taglist[j].a[aB]==aC){return this.taglist[j]}}};N.RotateTag=function(aI,aB,aH,i,aF,aA){var aG=aI.xformed,aD=new Z(aG.x,aG.y,aG.z),aC=ae(aH,aB),j=aD.angle(aC),aE=aD.cross(aC).unit();if(j==0){this.fixedCallbackTag=aI;this.fixedCallback=aF}else{this.fixedAnim={angle:-j,axis:aE,t:i,t0:D(),cb:aF,tag:aI,active:aA}}};N.TagToFront=function(i,aA,aB,j){this.RotateTag(i,0,0,aA,aB,j)};x.Start=function(aA,i,j){x.tc[aA]=new x(aA,i,j)};function aq(i,j){x.tc[j]&&x.tc[j][i]()}x.Linear=function(i,j){return j/i};x.Smooth=function(i,j){return 0.5-v(j*Math.PI/i)/2};x.Pause=function(i){aq("Pause",i)};x.Resume=function(i){aq("Resume",i)};x.Reload=function(i){aq("Load",i)};x.Update=function(i){aq("Update",i)};x.SetSpeed=function(j,i){if(F(i)&&x.tc[j]&&!isNaN(i[0])&&!isNaN(i[1])){x.tc[j].SetSpeed(i);return true}return false};x.TagToFront=function(j,i){if(!F(i)){return false}i.lat=i.lng=0;return x.RotateTag(j,i)};x.RotateTag=function(aA,i){if(F(i)&&x.tc[aA]){if(isNaN(i.time)){i.time=500}var j=x.tc[aA].FindTag(i);if(j){x.tc[aA].RotateTag(j,i.lat,i.lng,i.time,i.callback,i.active);return true}}return false};x.Delete=function(i){delete a[i];delete x.tc[i]};x.NextFrame=function(i){var j=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;x.NextFrame=j?x.NextFrameRAF:x.NextFrameTimeout;x.NextFrame(i)};x.NextFrameRAF=function(){requestAnimationFrame(L)};x.NextFrameTimeout=function(i){setTimeout(L,i)};x.tc={};x.options={z1:20000,z2:20000,z0:0.0002,freezeActive:false,freezeDecel:false,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:false,depth:0.5,maxSpeed:0.05,minSpeed:0,decel:0.95,interval:20,minBrightness:0.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",outlineRadius:0,textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:true,zoom:1,weight:false,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",0.33:"#ff0",0.66:"#0f0",1:"#00f"},txtOpt:true,txtScale:2,frontSelect:false,wheelZoom:true,zoomMin:0.3,zoomMax:3,zoomStep:0.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:false,noSelect:false,noMouse:false,imageScale:1,paused:false,dragControl:false,dragThreshold:4,centreFunc:at,splitWidth:0,animTiming:"Smooth",clickToFront:false,fadeIn:0,padding:0,bgColour:null,bgRadius:0,bgOutline:null,bgOutlineThickness:0,outlineIncrease:4};for(J in x.options){x[J]=x.options[J]}window.TagCanvas=x;Y("load",function(){x.loaded=1},window)})();
