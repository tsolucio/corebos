var CalendarDate={getDaysInMonth:function(e,a){return new Date(e,a+1,0).getDate()},getWeeksInMonth:function(e,a){return 0===this.getDayOfWeekOfFirstMonthDay(e,a)&&28===this.getDaysInMonth(e,a)?4:5},getDayOfWeekOfFirstMonthDay:function(e,a){var t=new Date(e,a).getDay();return 0===t&&(t=7),t-1},getMonthMatrix:function(e,a){for(var t=this.getDayOfWeekOfFirstMonthDay(e,a),n=this.getDaysInMonth(e,a),r=this.getWeeksInMonth(e,a),l=[],d=1,o=0;o<r;o++){l[o]=[];for(var s=0;s<7;s++){document.createElement("td");0==o?s>=t?(l[o][s]=d,d++):l[o][s]=null:o==r-1?d<=n?(l[o][s]=d,d++):l[o][s]=null:(l[o][s]=d,d++)}}return l},getCurrentDate:function(){var e=new Date,a=e.getUTCFullYear(),t=e.getUTCMonth(),n=e.getUTCDate();return{year:a,monthIndex:t,day:n}}},CalendarMarkup={lang:{daysOfWeeks:["Mon","Thu","Wed","Thr","Fri","Sat","Sun"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},createTableHead:function(){for(var e=document.createElement("div"),a=document.createElement("div"),t=[],n=0;n<7;n++){var r=document.createElement("div");r.innerHTML=this.lang.daysOfWeeks[n],t.push(r),a.appendChild(r)}return e.appendChild(a),{thead:e,row:a,thCollection:t}},createTableBody:function(e,a){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=CalendarDate.getMonthMatrix(e,a),r=document.createElement("div"),l=[],d=null,o=null,s=CalendarDate.getCurrentDate(),i=[],c=[],u=0;u<n.length;u++){var h=document.createElement("div");c.push(h),r.appendChild(h);for(var C=0;C<n[u].length;C++){var p=document.createElement("div");null===n[u][C]?l.push(p):(p.innerHTML=n[u][C],i.push(p),null!==t&&n[u][C]==t&&(d=p),s.year===e&&s.monthIndex===a&&s.day===n[u][C]&&(o=p)),h.appendChild(p)}}return{tbody:r,rowCollection:c,tdCollection:i,inactiveTdCollection:l,currentTd:d,currentDateTd:o}},createEmptyTable:function(){var e=document.createElement("div");return e},createPrevButton:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=document.createElement("div");return a.innerHTML=e,a},createNextButton:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=document.createElement("div");return a.innerHTML=e,a},createMonthSelect:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=document.createElement("select"),t=0;t<this.lang.months.length;t++){var n=document.createElement("option");n.setAttribute("value",t),n.innerHTML=this.lang.months[t],t==e&&n.setAttribute("selected",1),a.appendChild(n)}return a},createYearSelect:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1950,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2050,n=document.createElement("select"),r=a;r<=t;r++){var l=document.createElement("option");l.setAttribute("value",r),l.innerHTML=r,r==e&&l.setAttribute("selected",!0),n.appendChild(l)}return n},createEmptyHeader:function(){var e=document.createElement("header");return e},createEmptyCalendar:function(){var e=document.createElement("calendar");return e}},CalendarDecorator={theme:{def:{classPrefix:"bny-",calendarClass:"cal",headerClass:"cal-header",monthClass:"cal-month",yearClass:"cal-year",prevButtonClass:"cal-prev",nextButtonClass:"cal-next",tableClass:"cal-table",tableHeadClass:"cal-head",tableHeadDayOfWeekClass:"cal-day-of-week",tableBodyClass:"cal-body",tableRowClass:"cal-row",weekClass:"cal-week",dayClass:"cal-day",dayInactiveClass:"cal-day-inactive",dayCurrentClass:"cal-day-current",currentDateClass:"cal-day-today",popupClass:"cal-popup",popupBodyFadeClass:"cal-popup-body-fade"}},buildClass:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"def";return this.theme[a].classPrefix+this.theme[a][e+"Class"]},decorateTableHead:function(e,a,t){e.classList.add(this.buildClass("tableHead")),a.classList.add(this.buildClass("tableRow"));for(var n=0;n<t.length;n++)t[n].classList.add(this.buildClass("tableHeadDayOfWeek"))},decorateTableBody:function(e,a,t,n,r,l){e.classList.add(this.buildClass("tableBody"));for(var d=0;d<a.length;d++)a[d].classList.add(this.buildClass("tableRow")),a[d].classList.add(this.buildClass("week"));for(d=0;d<t.length;d++)t[d].classList.add(this.buildClass("day"));for(d=0;d<n.length;d++)n[d].classList.add(this.buildClass("dayInactive"));null!==r&&r.classList.add(this.buildClass("dayCurrent")),null!==l&&l.classList.add(this.buildClass("currentDate"))},setCurrentDay:function(e,a){for(var t=0;t<e.length;t++)e[t].innerHTML==a?e[t].classList.add(this.buildClass("dayCurrent")):e[t].classList.contains(this.buildClass("dayCurrent"))&&e[t].classList.remove(this.buildClass("dayCurrent"))},decorateTable:function(e){e.classList.add(this.buildClass("table"))},decoratePrevButton:function(e){e.classList.add(this.buildClass("prevButton"))},decorateNextButton:function(e){e.classList.add(this.buildClass("nextButton"))},decorateMonthSelect:function(e){e.classList.add(this.buildClass("month"))},decorateYearSelect:function(e){e.classList.add(this.buildClass("year"))},decorateHeader:function(e){e.classList.add(this.buildClass("header"))},decorateCalendar:function(e){e.classList.add(this.buildClass("calendar"))},decorateCalendarPopup:function(e){e.classList.add(this.buildClass("popup")),document.body.classList.add(this.buildClass("popupBodyFade"))},undecorateCalendarPopup:function(e){e.classList.remove(this.buildClass("popup")),document.body.classList.remove(this.buildClass("popupBodyFade"))}},CalendarController={attachDayClickEvent:function(e){for(var a=Calendar._calendars[e].tableBody.tdCollection,t=0;t<a.length;t++)a[t].addEventListener("click",function(){Calendar.pickDay(e,Calendar._calendars[e].displayedYear,Calendar._calendars[e].displayedMonthIndex,this.innerHTML)})},attachMonthSelectEvent:function(e){Calendar._calendars[e].headerMonthSelect.addEventListener("change",function(){Calendar.changeMonth(e,Calendar._calendars[e].displayedYear,+this.value)})},attachYearSelectEvent:function(e){Calendar._calendars[e].headerYearSelect.addEventListener("change",function(){Calendar.changeMonth(e,this.value,Calendar._calendars[e].displayedMonthIndex)})},attachPrevClickEvent:function(e){Calendar._calendars[e].headerPrevButton.addEventListener("click",function(){0===Calendar._calendars[e].displayedMonthIndex?Calendar.changeMonth(e,Calendar._calendars[e].displayedYear-1,11):Calendar.changeMonth(e,Calendar._calendars[e].displayedYear,Calendar._calendars[e].displayedMonthIndex-1)})},attachNextClickEvent:function(e){Calendar._calendars[e].headerNextButton.addEventListener("click",function(){11===Calendar._calendars[e].displayedMonthIndex?Calendar.changeMonth(e,Calendar._calendars[e].displayedYear+1,0):Calendar.changeMonth(e,Calendar._calendars[e].displayedYear,Calendar._calendars[e].displayedMonthIndex+1)})},attachCloseOnOutsideClickEvent:function(e){document.addEventListener("click",function(){Calendar.isHidden(e)||Calendar.hide(e)}),Calendar.getCalendar(e).addEventListener("click",function(e){e.stopPropagation()})}},Calendar={_calendars:{},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"datepicker",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1950,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2050,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=CalendarDate.getCurrentDate();null===n&&(n=d.year),null===r&&(r=d.monthIndex),null===l&&(l=d.day);var o=CalendarMarkup.createEmptyCalendar();CalendarDecorator.decorateCalendar(o);var s=CalendarMarkup.createEmptyHeader();CalendarDecorator.decorateHeader(s);var i=CalendarMarkup.createPrevButton();CalendarDecorator.decoratePrevButton(i);var c=CalendarMarkup.createNextButton();CalendarDecorator.decorateNextButton(c);var u=CalendarMarkup.createMonthSelect(r);CalendarDecorator.decorateMonthSelect(u);var h=CalendarMarkup.createYearSelect(n,a,t);CalendarDecorator.decorateYearSelect(h),s.appendChild(i),s.appendChild(u),s.appendChild(h),s.appendChild(c);var C=CalendarMarkup.createEmptyTable();CalendarDecorator.decorateTable(C);var p=CalendarMarkup.createTableHead();CalendarDecorator.decorateTableHead(p.thead,p.row,p.thCollection);var v=CalendarMarkup.createTableBody(n,r,l);return CalendarDecorator.decorateTableBody(v.tbody,v.rowCollection,v.tdCollection,v.inactiveTdCollection,v.currentTd,v.currentDateTd),C.appendChild(p.thead),C.appendChild(v.tbody),o.appendChild(s),o.appendChild(C),this._calendars[e]={selectedYear:n,selectedMonthIndex:r,selectedDay:l,displayedYear:n,displayedMonthIndex:r,minYear:a,maxYear:t,calendar:o,header:s,headerPrevButton:i,headerMonthSelect:u,headerYearSelect:h,headerNextButton:c,table:C,tableHead:p,tableBody:v,onPickHandlers:[]},CalendarController.attachPrevClickEvent(e),CalendarController.attachNextClickEvent(e),CalendarController.attachMonthSelectEvent(e),CalendarController.attachYearSelectEvent(e),CalendarController.attachDayClickEvent(e),CalendarController.attachCloseOnOutsideClickEvent(e),o},changeMonth:function(e,a,t){var n=this._calendars[e];if(a<n.minYear||a>n.maxYear)return!1;var r=null;a==n.selectedYear&&t==n.selectedMonthIndex&&(r=n.selectedDay),n.displayedYear=a,n.displayedMonthIndex=t;var l=CalendarMarkup.createTableBody(a,t,r);CalendarDecorator.decorateTableBody(l.tbody,l.rowCollection,l.tdCollection,l.inactiveTdCollection,l.currentTd,l.currentDateTd),n.tableBody.tbody.parentNode.removeChild(n.tableBody.tbody),n.tableBody=l,n.table.appendChild(l.tbody),n.headerYearSelect.querySelector("option[selected]").removeAttribute("selected"),n.headerYearSelect.querySelector('option[value="'+a+'"]').setAttribute("selected","selected"),n.headerYearSelect.value=a,n.headerMonthSelect.querySelector("option[selected]").removeAttribute("selected"),n.headerMonthSelect.options[t].setAttribute("selected","selected"),n.headerMonthSelect.value=t,CalendarController.attachDayClickEvent(e)},pickDay:function(e,a,t,n){this._calendars[e].selectedYear=a,this._calendars[e].selectedMonthIndex=t,this._calendars[e].selectedDay=n,CalendarDecorator.setCurrentDay(this._calendars[e].tableBody.tdCollection,n);for(var r=0;r<this._calendars[e].onPickHandlers.length;r++){var l=parseInt(t)+1,a=parseInt(a),n=parseInt(n);this._calendars[e].onPickHandlers[r](a,l,n)}},onPick:function(e,a){this._calendars[e].onPickHandlers.push(a)},getCalendar:function(e){return this._calendars[e].calendar},show:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a&&CalendarDecorator.decorateCalendarPopup(this._calendars[e].calendar),this._calendars[e].calendar.classList.remove("hidden")},hide:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a&&CalendarDecorator.undecorateCalendarPopup(this._calendars[e].calendar),this._calendars[e].calendar.classList.add("hidden")},isHidden:function(e){return this._calendars[e].calendar.classList.contains("hidden")}},DatePicker={_pickers:{},_options:{minYear:1950,maxYear:2050,popup:!1,onlyAsNativeFallback:!0},create:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var t in this._options)void 0===a[t]&&(a[t]=this._options[t]);if(a.onlyAsNativeFallback&&this.isNativeDatePickerSupported())return 2;var n=this,r=document.getElementById(e),l=r.name;r.id="_"+e,r.name="_"+l;var d=document.createElement("input");d.id=e,d.name=l,d.type="hidden",r.parentNode.insertBefore(d,r.nextSibling);var o=e+"_calendar";if(""!==r.value){d.value=n.getSqlDateFromEuropeanDate(r.value);var s=this.getDatePartsFromISODate(d.value);Calendar.create(o,a.minYear,a.maxYear,s.year,s.monthIndex,s.day)}else Calendar.create(o,a.minYear,a.maxYear);return Calendar.hide(o,a.popup),Calendar.onPick(o,function(e,t,l){d.value=n.getSqlDateFromDateParts(e,t-1,l),r.value=n.getEuropeanDateFromDateParts(e,t-1,l),Calendar.hide(o,a.popup)}),r.addEventListener("focus",function(){Calendar.show(o,a.popup)}),r.addEventListener("click",function(e){e.stopPropagation()}),r.parentNode.insertBefore(Calendar.getCalendar(o),r.nextSibling),this._pickers[e]={input:r,options:a},1},twoDigits:function(e){return e<10?"0"+e:e},getDatePartsFromISODate:function(e){var a=new Date(e);return{year:a.getUTCFullYear(),monthIndex:a.getUTCMonth(),month:a.getUTCMonth()+1,monthStr:this.twoDigits(a.getUTCMonth()+1),day:a.getUTCDate(),dayStr:this.twoDigits(a.getUTCDate())}},getISODateFromDateParts:function(e,a,t){var n=parseInt(a)+1,r=this.twoDigits(n),l=this.twoDigits(t);return e+"-"+r+"-"+l},getSqlDateFromISODate:function(e){return e},getSqlDateFromDateParts:function(e,a,t){return this.getISODateFromDateParts(e,a,t)},getSqlDateFromEuropeanDate:function(e){if(/\d{2}(\.)\d{2}(\.)\d{4}/.test(e)){var a=e.split(".");return a[2]+"-"+a[1]+"-"+a[0]}return""},getEuropeanDateFromSqlDate:function(e){if(/\d{4}(\-)\d{2}(\-)\d{2}/.test(e)){var a=e.split("-");return a[2]+"."+a[1]+"."+a[0]}return""},getEuropeanDateFromISODate:function(e){var a=this.getDatePartsFromISODate(e);return a.dayStr+"."+a.monthStr+"."+a.year},getEuropeanDateFromDateParts:function(e,a,t){var n=parseInt(a)+1,r=this.twoDigits(n),l=this.twoDigits(t);return l+"."+r+"."+e},isNativeDatePickerSupported:function(){var e=document.createElement("input");e.setAttribute("type","date");var a="not-a-date";return e.setAttribute("value",a),e.value!==a}};