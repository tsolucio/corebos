var ImageUploadConfig={tagName:"imageupload",attrQuality:"quality",defaultQuality:.7,attrOutputSize:"outputsize",defaultOutputSize:"300"},ImageUpload={Config:ImageUploadConfig,init:function(t){var e=this.getImagePreview(t);e._src=e.src,this.addEvents(t)},initAll:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;[].forEach.call(this.getAll(e),function(e){t.init(e)})},addEvents:function(t){var e=this,i=this.getFileInput(t),n=this.getModal(t),a=this.getImageProcessor(t),o=this.getImagePreview(t);i.addEventListener("change",function(a){n!==!1?Modal.show(n):e.setImage(t,i.files[0])}),o.addEventListener("click",function(){i.click()}),o.addEventListener("keypress",function(t){t.keyCode===KEY_ENTER&&i.click()}),n!==!1&&(Modal.onShow(n,function(){ImageProcessor.setOutputSize(a,e.getOutputSize(t)),ImageProcessor.setQuality(a,e.getQuality(t)),ImageProcessor.init(a,i.files[0],function(t){Modal.hide(n),o.src=t,i._file=BunnyFile.base64ToBlob(t)})}),Modal.onHide(n,function(){ImageProcessor.deinit(a)})),i.form.addEventListener("reset",function(t){o.src=o._src,delete i._file}),i.files.length>0&&this.setImage(t,i.files[0])},getQuality:function(t){var e=t.getAttribute(this.Config.attrQuality);return e=e?parseFloat(e):this.Config.defaultQuality},getOutputSize:function(t){var e=t.getAttribute(this.Config.attrOutputSize);return e=e?parseFloat(e):this.Config.defaultOutputSize},getAll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return t.getElementsByTagName(this.Config.tagName)},getFileInput:function(t){return t.getElementsByTagName("input")[0]||!1},getImagePreview:function(t){return t.getElementsByTagName("img")[0]||!1},getModal:function(t){return Modal.UI.getAll(t)[0]||!1},getImageProcessor:function(t){return ImageProcessor.UI.getAll(t)[0]||!1},setImage:function(t,e){var i=this.getFileInput(t),n=this.getImagePreview(t),a=this.getOutputSize(t),o=this.getQuality(t);BunnyImage.getImage(e).then(function(t){var e=BunnyImage.resizeImage(t,a,a);return e.toDataURL("image/jpeg",o)}).then(function(t){return n.src=t,i._file=BunnyFile.base64ToBlob(t),t})}};document.addEventListener("DOMContentLoaded",function(){ImageUpload.initAll()});