function getActionObject(t){var e=t.getAttribute("action"),a=e.split("."),n=a[0],r=null;if(void 0===a[1])r=window[n];else{var i=a[1];try{r=window[n][i].bind(window[n])}catch(t){}}if(void 0===r)throw new Error('Bunny Error: Model search action specified in action="'+e+'" attribute not found');return r}function initObjectExtensions(t,e){var a=Object.keys(t);a.forEach(function(a){0===a.indexOf("init")&&t[a](e)})}function pushToElementProperty(t,e,a){void 0===t[e]&&(t[e]=[]),t[e].push(a)}function pushCallbackToElement(t,e,a){pushToElementProperty(t,"__bunny_"+e+"_callbacks",a)}function callElementCallbacks(t,e,a){var n=t["__bunny_"+e+"_callbacks"];void 0!==n&&!function(){var t=function t(e){var r=a(n[e]);r instanceof Promise?r.then(function(a){a!==!1&&e>0&&t(e-1)}):r!==!1&&e>0&&t(e-1)};t(n.length-1)}()}var DataTableConfig={tagName:"datatable",attrUrl:"url",attrTemplate:"template",tagNamePagination:"pagination",tagNameStats:"stats",classNameAsc:"arrow-down",classNameDesc:"arrow-up",perPage:15,paginationLimit:7,ajaxHeaders:[]},DataTableUI={Config:DataTableConfig,Template:Template,getSearchInput:function(t,e){return t.querySelector('[name="'+e+'"]')||!1},getColumn:function(t,e){return this.getTable(t).querySelector('[pid="'+e+'"]')||!1},getAllSearchInputs:function(t){return t.querySelectorAll("input, select")},getTable:function(t){return t.getElementsByTagName("table")[0]},getOrderCells:function(t){return t.querySelectorAll("th[pid]")},getPagination:function(t){return t.getElementsByTagName(this.Config.tagNamePagination)[0]},getStats:function(t){return t.getElementsByTagName(this.Config.tagNameStats)[0]},removeRows:function(t){for(var e=this.getTable(t),a=e.rows.length,n=a-1;n>0;n--)e.deleteRow(n)},insertRows:function(t,e,a){var n=document.getElementById(a);"TEMPLATE"===n.tagName?this.getTable(t).appendChild(parseTemplate(a,e)):this.Template.insertAll(a,e,this.getTable(t))},clearAllColumnsOrder:function(t){var e=this,a=t.parentNode.querySelectorAll("th");[].forEach.call(a,function(t){t.classList.remove(e.Config.classNameAsc),t.classList.remove(e.Config.classNameDesc)})},setColumnAsc:function(t){this.clearAllColumnsOrder(t),t.classList.add(this.Config.classNameAsc)},setColumnDesc:function(t){this.clearAllColumnsOrder(t),t.classList.add(this.Config.classNameDesc)},isColumnAsc:function(t){return t.classList.contains(this.Config.classNameAsc)},isColumnDesc:function(t){return t.classList.contains(this.Config.classNameDesc)}},DataTable={Config:DataTableConfig,UI:DataTableUI,Ajax:Ajax,Pagination:Pagination,init:function(t){if(void 0!==t.__bunny_datatable)return!1;t.__bunny_datatable={};var e=BunnyURL.getParam("page");void 0===e&&(e=1),this.addEvents(t),initObjectExtensions(this,t);var a=this.getOrderDataFromURL(t);if(void 0!==a.order_by){var n=this.UI.getColumn(t,a.order_by);"asc"===a.order_rule?this.UI.setColumnAsc(n):this.UI.setColumnDesc(n)}return this.setARIA(t),this.changePage(t,e,this.getSearchAndOrderDataFromURL(t)),!0},initAll:function(){var t=this;ready(function(){[].forEach.call(document.getElementsByTagName(t.Config.tagName),function(e){t.init(e)})})},isInitiated:function(t){return void 0!==t.__bunny_datatable},getTemplateId:function(t){return t.getAttribute(this.Config.attrTemplate)},getAjaxUrl:function(t){return t.getAttribute(this.Config.attrUrl)},getAjaxHeaders:function(){var t={};return DataTableConfig.ajaxHeaders.forEach(function(e){var a=e.split(": ");t[a[0]]=a[1]}),t},addAjaxHeader:function(t){this.Config.ajaxHeaders.push(t)},getSearchData:function(t){var e=this.UI.getAllSearchInputs(t),a={};return[].forEach.call(e,function(t){t&&t.value.length>0&&(a[t.name]=t.value)}),a},getSearchDataFromURL:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,a=BunnyURL.getParams(e),n={};for(var r in a)if("page"!==r){var i=this.UI.getSearchInput(t,r);i&&(i.value=a[r],n[r]=a[r])}return n},getOrderData:function(t){for(var e={},a=this.UI.getOrderCells(t),n=0;n<a.length;n++){var r=a[n];if(this.UI.isColumnAsc(r)){e.order_by=r.getAttribute("pid"),e.order_rule="asc";break}if(this.UI.isColumnDesc(r)){e.order_by=r.getAttribute("pid"),e.order_rule="desc";break}}return e},getOrderDataFromURL:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,a=BunnyURL.getParam("order_by",e),n={};return a&&(n.order_by=a,n.order_rule=BunnyURL.getParam("order_rule",e)),n},getSearchAndOrderData:function(t){return Object.assign(this.getSearchData(t),this.getOrderData(t))},getSearchAndOrderDataFromURL:function(t){return Object.assign(this.getSearchDataFromURL(t),this.getOrderDataFromURL(t))},getDataUrl:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.Pagination.addPageParamToUrl(this.getAjaxUrl(t),e);return n=BunnyURL.setParams(a,n)},addEvents:function(t){var e=this,a=this.UI.getAllSearchInputs(t);[].forEach.call(a,function(a){var n="INPUT"===a.tagName?"input":"change";addEventOnce(a,n,function(){e.update(t,e.getDataUrl(t,1,e.getSearchAndOrderData(t)))})});var n=this.UI.getOrderCells(t);[].forEach.call(n,function(a){a.addEventListener("click",function(){e.UI.isColumnAsc(a)?(e.UI.setColumnDesc(a),e.update(t,e.getDataUrl(t,e.getPage(),e.getSearchAndOrderData(t)))):e.UI.isColumnDesc(a)?(e.UI.clearAllColumnsOrder(a),e.update(t,e.getDataUrl(t,e.getPage(),e.getSearchData(t)))):(e.UI.setColumnAsc(a),e.update(t,e.getDataUrl(t,e.getPage(),e.getSearchAndOrderData(t))))})})},setARIA:function(t){var e=this.UI.getOrderCells(t);[].forEach.call(e,function(t){makeAccessible(t)})},attachPaginationEventHandlers:function(t){var e=this,a=this.UI.getPagination(t);this.Pagination.onItemClick(a,function(a,n){e.changePage(t,a)})},callHandlers:function(t,e){callElementCallbacks(t,"datatable_redraw",function(t){t(e)})},callBeforeHandlers:function(t,e){callElementCallbacks(t,"datatable_before_redraw",function(t){t(e)})},onBeforeRedraw:function(t,e){pushCallbackToElement(t,"datatable_before_redraw",e)},onRedraw:function(t,e){pushCallbackToElement(t,"datatable_redraw",e)},fetchData:function(t,e){var a=this;return new Promise(function(t){a.Ajax.get(e,function(e){e=JSON.parse(e),t(e)},{},a.getAjaxHeaders())})},changePage:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===a&&(a=this.getSearchAndOrderData(t)),this.update(t,this.getDataUrl(t,e,a))},getPage:function(){var t=BunnyURL.getParam("page");return t?t:1},updateURL:function(t,e){var a=window.location.href,n=BunnyURL.getParam("page",e);n>1?a=BunnyURL.setParam("page",n):BunnyURL.hasParam("page",a)&&(a=BunnyURL.removeParam("page",a));var r=BunnyURL.getParam("order_by",e);r&&(a=BunnyURL.setParam("order_by",r,a),a=BunnyURL.setParam("order_rule",BunnyURL.getParam("order_rule",e),a));var i=this.UI.getAllSearchInputs(t);[].forEach.call(i,function(t){var n=t.name,r=BunnyURL.getParam(n,e);r&&""!==r?a=BunnyURL.setParam(n,r,a):BunnyURL.hasParam(n,a)&&(a=BunnyURL.removeParam(n,a))}),a!==window.location.href&&window.history.replaceState("","",a)},update:function(t,e){var a=this;this.callBeforeHandlers(t),this.UI.getTable(t).classList.remove("in"),this.fetchData(t,e).then(function(n){var r=a.UI.getPagination(t),i=a.Pagination;i.initOrUpdate(r,n,a.getSearchAndOrderData(t)),a.attachPaginationEventHandlers(t);var o=a.UI.getStats(t);void 0!==o&&(o.textContent=i.getStats(r)),a.UI.removeRows(t),a.UI.insertRows(t,n.data,a.getTemplateId(t)),a.UI.getTable(t).classList.add("in"),a.updateURL(t,e),a.callHandlers(t,n)})}};DataTable.initAll();