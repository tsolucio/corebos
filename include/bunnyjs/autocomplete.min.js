var AutocompleteConfig=Object.assign({},DropdownConfig,{useTagNames:!0,tagName:"autocomplete",delay:200,minChar:2,showMark:!1,allowCustomInput:!1,classNameNotFound:"dropdown-header",textNotFound:"No results found"}),AutocompleteUI=Object.assign({},DropdownUI,{Config:AutocompleteConfig,getInput:function(t){return t.querySelector('input:not([type="hidden"])')||!1},getHiddenInput:function(t){return t.querySelector('input[type="hidden"]')||!1},getTriggerElement:function(t){return this.getInput(t)}}),Autocomplete=Object.assign({},Dropdown,{UI:AutocompleteUI,Config:AutocompleteConfig,init:function(t){return void 0===t.__bunny_autocomplete&&(t.__bunny_autocomplete={},t.__bunny_autocomplete_state=this.getCurState(t),this._addEvents(t),this._setARIA(t),initObjectExtensions(this,t),!0)},_setARIA:function(t){Dropdown._setARIA(t);var e=this.UI.getInput(t);e.setAttribute("role","combobox"),e.setAttribute("aria-autocomplete","list")},close:function(t){Dropdown.close.call(this,t),this.UI.removeMenuItems(t)},_addEvents:function(t){var e=this,n=this.UI.getInput(t);this._addEventFocus(t,n),this.onItemSelect(t,function(n){null===n?e._selectItem(t,!1):e._selectItem(t,n)})},isCustomValueAllowed:function(t){return t.hasAttribute("custom")||this.Config.allowCustomInput},isMarkDisplayed:function(t){return t.hasAttribute("mark")||this.Config.showMark},getMinChar:function(t){return t.hasAttribute("min")?t.getAttribute("min"):this.Config.minChar},isNotFoundDisplayed:function(t){return t.hasAttribute("shownotfound")},_addEventInput:function(t,e){var n=this;t.__bunny_autocomplete_input=addEventOnce(e,"input",function(){e.value.length>=n.getMinChar(t)?n.update(t,e.value):n.close(t)},this.Config.delay)},_addEventFocus:function(t,e){var n=this;e.addEventListener("focus",function(){t.__bunny_autocomplete_initial_value=e.value,n._addEventFocusOut(t,e),n._addEventInput(t,e),t.__bunny_autocomplete_keydown_closed=addEvent(e,"keydown",function(e){n.UI.isOpened(t)||e.keyCode===KEY_ENTER&&n.isStateChanged(t)&&(e.preventDefault(),n._selectItem(t,!1),n.isCustomValueAllowed(t)&&n._callItemSelectCallbacks(t,null))})})},_addEventFocusOut:function(t,e){var n=this,u=addEvent(e,"blur",function(){setTimeout(function(){n.UI.isMenuItem(t,document.activeElement)||(removeEvent(e,"blur",u),removeEvent(e,"input",t.__bunny_autocomplete_input),delete t.__bunny_autocomplete_input,removeEvent(e,"keydown",t.__bunny_autocomplete_keydown_closed),delete t.__bunny_autocomplete_keydown_closed,0===e.value.length?n.clear(t):!n.isCustomValueAllowed(t)&&n.isStateChanged(t)&&n.restoreState(t))},300)})},_addItemEvents:function(t,e){var n=this;[].forEach.call(e.childNodes,function(e){e.addEventListener("click",function(){n._callItemSelectCallbacks(t,e)})})},update:function(t,e){var n=this;callElementCallbacks(t,"autocomplete_before_update",function(t){t()});var u=getActionObject(t);u(e).then(function(u){if(callElementCallbacks(t,"autocomplete_update",function(t){var e=t(u);void 0!==e&&(u=e)}),Object.keys(u).length>0){n.close(t);var o=void 0;o=n.isMarkDisplayed(t)?n.UI.createMenuItems(u,function(t,n,u){var o=new RegExp("("+e+")","ig"),a=u.replace(o,"<mark>$1</mark>");return t.innerHTML=a,t.dataset.value=n,t}):n.UI.createMenuItems(u),n._addItemEvents(t,o),n.UI.setMenuItems(t,o),n._setARIA(t),n.open(t)}else n.close(t),n.isNotFoundDisplayed(t)&&(n.UI.getMenu(t).appendChild(n.createNotFoundElement()),n.open(t))}).catch(function(e){n.UI.getMenu(t).innerHTML=e.message,n.open(t),callElementCallbacks(t,"autocomplete_update",function(t){t(!1,e)})})},createNotFoundElement:function(){var t=document.createElement("div");return t.classList.add(this.Config.classNameNotFound),t.textContent=this.Config.textNotFound,t},onBeforeUpdate:function(t,e){pushCallbackToElement(t,"autocomplete_before_update",e)},onUpdate:function(t,e){pushCallbackToElement(t,"autocomplete_update",e)},restoreState:function(t){var e=this.getState(t);this.UI.getInput(t).value=e.label;var n=this.UI.getHiddenInput(t);n&&(n.value=e.value),this.close(t)},clear:function(t){var e=this.UI.getInput(t),n=this.UI.getHiddenInput(t);e.value="",n&&(n.value=""),t.__bunny_autocomplete_state=this.getCurState(t),this._callItemSelectCallbacks(t,!1),this.close(t)},getValue:function(t){var e=this.UI.getHiddenInput(t);return e?e.value:this.UI.getInput(t).value},getState:function(t){return t.__bunny_autocomplete_state},getCurState:function(t){var e={},n=this.UI.getInput(t),u=this.UI.getHiddenInput(t);return e.label=n.value,u&&(e.value=u.value),e},isStateChanged:function(t){return JSON.stringify(this.getState(t))!==JSON.stringify(this.getCurState(t))},_updateInputValues:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.UI.getInput(t);e!==!1?(n.value=e.textContent,t.__bunny_autocomplete_initial_value=e.textContent):this.isCustomValueAllowed(t)?t.__bunny_autocomplete_initial_value=n.value:(n.value="",t.__bunny_autocomplete_initial_value="");var u=this.UI.getHiddenInput(t);u&&(e!==!1?u.value=this.UI.getItemValue(e):this.isCustomValueAllowed(t)?u.value=n.value:u.value=""),t.__bunny_autocomplete_state=this.getCurState(t)},_selectItem:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e!==!1||this.isCustomValueAllowed(t)?this._updateInputValues(t,e):this.restoreState(t),this.close(t)}});document.addEventListener("DOMContentLoaded",function(){Autocomplete.initAll()});